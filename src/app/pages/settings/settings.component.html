<app-header></app-header>
<div class="cont">
    <div class="settings">
        <div class="userInfo">
            <div class="userInfo__ProfImg">
                <ng-container *ngIf="!isLoading; else showLoadingImage">
                    <img [src]="currentUser.image" alt="Profile Image" class="profile-img" (click)="triggerImageUpload()"/>
                    <input type="file" id="userInfo__ProfImg__Input" (change)="changeProfileImage($event, currentUser._id)" 
                    hidden accept=".jpg, .jpeg, .png">
                </ng-container>

                <ng-template #showLoadingImage>
                    <div class="skeleton-img"></div>
                </ng-template>
            </div>
            <div class="userInfo__Content">
                <div class="userInfo__Name">
                    <ng-container *ngIf="!isLoading; else showLoadingName">
                        <h2>სახელი:</h2>
                        <ng-container *ngIf="!shouldEdit[0]; else editUsername">
                            <h2 class="userInfo__DataHolder">{{ currentUser.name }}</h2>
                        </ng-container>
                        
                        <ng-template #editUsername>
                            <div class="userInfo__Name__edit">
                                <input type="text" placeholder="ახალი სახელი" [value]="currentUser.name" [(ngModel)]="newName">
                                <button class="MentorBtn-Green userInfo__Name__edit__SubmitBtn" 
                                (click)="editProfile(currentUser._id, 'name', newName)">
                                    შეცვლა
                                </button>
                            </div>
                        </ng-template>
                        <i class="fa-solid fa-pen-to-square" (click)="edit(0)"></i>   
                    </ng-container>

                    <ng-template #showLoadingName>
                        <div class="skeleton-text"></div>
                    </ng-template>
                </div>
                <div class="userInfo__Email">
                    <ng-container *ngIf="!isLoading; else showLoadingEmail">
                        <h2>ელფოსტა:</h2>
                        <ng-container *ngIf="!shouldEdit[1]; else editEmail">
                            <h2 class="userInfo__DataHolder">{{ currentUser.email }}</h2>
                        </ng-container>
                        
                        <ng-template #editEmail>
                            <div class="userInfo__Email__edit">
                                <input type="text" placeholder="ახალი ელ–ფოსტა" [value]="currentUser.email" [(ngModel)]="newEmail">
                                <button class="MentorBtn-Green userInfo__Email__edit__SubmitBtn" 
                                (click)="editProfile(currentUser._id, 'email', newEmail)">
                                    შეცვლა
                                </button>
                            </div>
                        </ng-template>
                        <i class="fa-solid fa-pen-to-square" (click)="edit(1)"></i> 
                    </ng-container>

                    <ng-template #showLoadingEmail>
                        <div class="skeleton-text"></div>
                    </ng-template>
                </div>
                <div class="userInfo__Password">
                    <ng-container *ngIf="!isLoading; else showLoadingPassword">
                        <h2>პაროლი:</h2>
                        <ng-container *ngIf="!shouldEdit[2]; else editPassword">
                            <h2 class="userInfo__DataHolder">{{ '•'.repeat(16) }}</h2>
                        </ng-container>
                        
                        <ng-template #editPassword>
                            <div class="userInfo__Password__edit">
                                <input type="text" placeholder="ახალი პაროლი" [value]="currentUser.password" [(ngModel)]="newPassword">
                                <button class="MentorBtn-Green userInfo__Password__edit__SubmitBtn" 
                                (click)="editProfile(currentUser._id, 'password', newPassword)">
                                    შეცვლა
                                </button>
                            </div>
                        </ng-template>
                        
                        <i class="fa-solid fa-pen-to-square" (click)="edit(2)"></i>  
                 </ng-container>

                 <ng-template #showLoadingPassword>
                    <div class="skeleton-text"></div>
                 </ng-template>
                </div>
                <div class="userInfo__Specialty">
                    <ng-container *ngIf="!isLoading; else showLoadingSpecialty">
                        <h2>პროფესია:</h2>
                            <ng-container *ngIf="!shouldEdit[3]; else editSpecialty">
                                <h2 class="userInfo__DataHolder">{{ currentUser.position }}</h2>
                            </ng-container>
                            
                            <ng-template #editSpecialty>
                                <div class="userInfo__Specialty__edit">
                                    <input type="text" placeholder="ახალი პროფესია" [value]="currentUser.position" [(ngModel)]="newSpecialty">
                                    <button class="MentorBtn-Green userInfo__Specialty__edit__SubmitBtn"
                                    (click)="editProfile(currentUser._id, 'position', newSpecialty)">
                                        შეცვლა
                                    </button>
                                </div>
                            </ng-template>
                            <i class="fa-solid fa-pen-to-square" (click)="edit(3)"></i>   
                    </ng-container>

                    <ng-template #showLoadingSpecialty>
                        <div class="skeleton-text"></div>
                    </ng-template>
                </div>
            </div>
        </div>
        <div class="experience">
            <ul *ngFor="let Experience of experiences">
                <li>{{Experience.company}}</li>
                <li>{{Experience.position}}</li>
                <li>{{Experience.description}}</li>
            </ul>
            <form (ngSubmit)="addExperience()" [formGroup]="experience">
                <div class="resume">
                    <div class="resume__company">
                        <label for="Company">კომპანია</label>
                        <input type="text" name="Company" formControlName="company">
                        <p class="error">
                            {{ (experience.get('company')?.touched && experience.get('company')?.invalid) ?
                             'გთხოვთ შეიყვანოთ კომპანიის ან დაწესებულების სახელი (2–70 სიმბოლო)' : ''}}
                        </p>
                    </div>
                    <div class="resume__position">
                        <label for="Position">პოზიცია</label>
                        <input type="text" name="Position" formControlName="position">
                        <p class="error">
                            {{ (experience.get('position')?.touched && experience.get('position')?.invalid)?
                             'გთხოვთ შეიყვანოთ თანამდებობა (2–50 სიმბოლო)' : '' }}
                        </p>
                    </div>
                    <div class="resume__description">
                        <label for="Description">აღწერა</label>
                        <textarea name="Description" formControlName="description"></textarea>
                        <p class="error">{{ (experience.get('description')?.touched && experience.get('description')?.invalid)?
                            'გთხოვთ შეიყვანოთ აღწერილობა (10–100 სიმბოლო)' : ''}}
                        </p>
                    </div>
                    <div class="resume__topController">
                        <input type="checkbox" formControlName="isOnTop">
                        <p>ტოპ გამოცდილებებში დამატება</p>
                    </div>
                    <div class="resume__ButtonHolder">
                        <button class="MentorBtn-Green settingsBtn">დამატება</button>
                    </div>
                    <p class="error">{{textIsSpammy? 'გთხოვთ მოერიდოთ სპამს' : ''}}</p>
                
                    @if (!gotErr) {
                        <p style="color: green; height: 10px;">{{ addedMsg }}</p>
                    } @else {
                        <p style="color: red; height: 10px;">{{ errMsg }}</p>
                    }
                </div>
            </form>
        </div>
    </div>
</div>

 